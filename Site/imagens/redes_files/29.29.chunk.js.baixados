(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{"+SXb":function(e,t,n){"use strict";n("/1Ha")},"/1Ha":function(e,t,n){},"5rCo":function(e,t,n){"use strict";n.r(t);var i=n("cDf5"),s=n.n(i),a=n("lSNA"),o=n.n(a),r=n("yXPU"),c=n.n(r),l=n("o0o1"),u=n.n(l),h=n("nyHz"),d={name:"AppIconInitializer",props:["pwaSettings"],data:function(){return{iconUrl:null,iconPostFix:""}},beforeMount:function(){this.setIconUrl(),"complete"===document.readyState&&(this.generateSiteIcons(),this.generateAppleIcons())},methods:{setIconUrl:function(){var e,t,n,i,s,a;if(null!==(e=this.pwaSettings)&&void 0!==e&&e.whitelabel_favicon&&null!==(t=this.pwaSettings)&&void 0!==t&&t.enabled&&(null===(n=this.pwaSettings)||void 0===n||!n.icon))return this.iconUrl=null===(a=this.pwaSettings)||void 0===a?void 0:a.whitelabel_favicon;var o=null!==(i=null===(s=this.pwaSettings)||void 0===s?void 0:s.icon)&&void 0!==i?i:null;o?this.iconUrl="".concat(this.rootHOST,"/config/storage/pwa/").concat(this.rootChannelID,"/").concat(o):(this.iconUrl=Object(h.j)("/assets/images/icon/icon"),this.iconPostFix=".png")},generateSiteIcons:function(){var e,t,n,i=this;if(null!==(e=this.pwaSettings)&&void 0!==e&&e.whitelabel_favicon&&null!==(t=this.pwaSettings)&&void 0!==t&&t.enabled&&(null===(n=this.pwaSettings)||void 0===n||!n.icon))return this.generateIcon("icon",this.iconUrl);[192,96,32,16].forEach((function(e){i.generateIcon("icon","".concat(i.iconUrl,"-").concat(e,"x").concat(e).concat(i.iconPostFix),e)}))},generateAppleIcons:function(){var e,t,n,i=this;if(null!==(e=this.pwaSettings)&&void 0!==e&&e.whitelabel_favicon&&null!==(t=this.pwaSettings)&&void 0!==t&&t.enabled&&(null===(n=this.pwaSettings)||void 0===n||!n.icon))return this.generateIcon("apple-touch-icon",this.iconUrl);[180,152,144,120,114,76,72,60,57].forEach((function(e){i.generateIcon("apple-touch-icon","".concat(i.iconUrl,"-").concat(e,"x").concat(e).concat(i.iconPostFix),e,null)}))},generateIcon:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"icon",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",s=document.createElement("link");s.rel=e,s.href=t,i&&(s.type=i),n&&(s.sizes="".concat(n,"x").concat(n)),document.head.appendChild(s)}}},p=n("KHd+"),f=Object(p.a)(d,(function(){return(0,this._self._c)("div")}),[],!1,null,null,null).exports,w=n("gfa5"),g=n("dCQc"),m={name:"BannerMessage"},v=Object(p.a)(m,(function(){var e=this._self._c;return e("div",{staticClass:"banner-message"},[e("div",{staticClass:"text"},[this._t("text")],2),this._v(" "),e("div",{staticClass:"actions"},[this._t("actions")],2)])}),[],!1,null,null,null).exports,b=n("fxp/"),y={name:"PwaInitializer",components:{BannerMessage:v},props:["pwaSettings","sessionData","windowMode","isOpen"],data:function(){return{loading:!1,isPushEnabled:!1,isCdn:0,storageNames:{installed:"pwa-installed",showBanner:"pwa-show-banner",dismissBanner:"pwa-dismiss-banner-forever"},pwaStatus:{installed:!1,showAlert:!1,dismissAlertForever:!1,deferredPrompt:null}}},computed:{rootPwaHost:function(){var e=Object(h.j)();return this.isCdn||(e="".concat(this.rootHOST,"/webchat/v2")),e},isIosPlatform:function(){var e=window.navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(e)},iframeInstallerLink:function(){return"".concat(this.rootPwaHost,"/?cid=").concat(this.rootChannelID,"&host=").concat(this.rootHOST)}},watch:{sessionData:function(e){null!=e&&e._id&&this.subscribe()}},beforeMount:function(){var e=this;return c()(u.a.mark((function t(){var n,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.storage=new b.a("local-storage"),new URL(window.location.href).origin.startsWith("https://cdn")&&(e.isCdn=1),n=new URL("/api/v4/webchat/".concat(e.rootChannelID,"/manifest.json?is_cdn=").concat(e.isCdn),e.rootHOST),"complete"===document.readyState&&((i=document.createElement("link")).rel="manifest",i.href="".concat(n),document.head.appendChild(i)),e.storageNames.installed+="-".concat(e.rootChannelID),e.storageNames.showBanner+="-".concat(e.rootChannelID),e.storageNames.dismissBanner+="-".concat(e.rootChannelID);case 8:case"end":return t.stop()}}),t)})))()},mounted:function(){var e=this;this.beforeInstallPwa(),this.getStorageValues(),this.registerServiceWorker(),window.addEventListener("appinstalled",function(){var t=c()(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setPwaCacheData({installed:!0,showAlert:!1});case 2:e.$emit("change-show-alert",!1),e.pwaStatus.deferredPrompt=null;case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.pwaStatus.installed&&this.subscribe()},methods:{getStorageValues:function(){if(!this.checkDeprecatedStorageValues()){var e=this.storage.get(this.storageNames.installed);this.pwaStatus.installed="true"===e||"1"===e;var t=this.storage.get(this.storageNames.showBanner);this.pwaStatus.showAlert="true"===t||"1"===t||null===t,this.$emit("change-show-alert",this.pwaStatus.showAlert),w.a.$emit("pwa-installed-status",this.pwaStatus.installed);var n=this.storage.get(this.storageNames.dismissBanner);this.pwaStatus.dismissAlertForever="true"===n||"1"===n}},checkDeprecatedStorageValues:function(){var e=this.storage.get("pwa-installed"),t=this.storage.get("pwa-show-banner"),n=this.storage.get("pwa-dismiss-banner-forever");return!!(e||t||n)&&(e="true"===e||"1"===e,t="true"===t||"1"===t||null===t,n="true"===n||"1"===n,this.setPwaCacheData({installed:e,showAlert:t,dismissAlertForever:n}),this.storage.destroy("pwa-installed"),this.storage.destroy("pwa-show-banner"),this.storage.destroy("pwa-dismiss-banner-forever"),!0)},beforeInstallPwa:function(){var e=this;window.addEventListener("beforeinstallprompt",function(){var t=c()(u.a.mark((function t(n){var i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setPwaCacheData({installed:!1,showAlert:!0}),e.$emit("change-show-alert",!0),n.preventDefault(),e.pwaStatus.deferredPrompt=n,t.next=6,e.pwaStatus.deferredPrompt.userChoice;case 6:i=t.sent,"accepted"===i.outcome&&e.subscribe(),e.pwaStatus.deferredPrompt=null;case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},registerServiceWorker:function(){var e=this;return c()(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("serviceWorker"in navigator){t.next=3;break}return console.warn("Service workers aren't supported in this browser."),t.abrupt("return");case 3:navigator.serviceWorker.register("".concat(e.rootPwaHost,"/service-worker.js"),{scope:"./?cid=".concat(e.rootChannelID)}).then((function(){return e.initialiseServiceWorker()}));case 4:case"end":return t.stop()}}),t)})))()},initialiseServiceWorker:function(){var e=this;"showNotification"in ServiceWorkerRegistration.prototype?"PushManager"in window?"denied"!==Notification.permission?navigator.serviceWorker.ready.then((function(t){t.pushManager.getSubscription().then((function(t){t?e.updateSubscription(t):e.pwaStatus.installed&&e.subscribe()})).catch((function(e){console.warn("Error during getSubscription()",e)})).finally((function(){return e.isPushEnabled=!0}))})):console.warn("The user has blocked notifications."):console.warn("Push messaging isn't supported."):console.warn("Notifications aren't supported.")},buttonInstallerAction:function(e){switch(e){case"install":if("window"===this.windowMode)return;this.pwaStatus.deferredPrompt&&this.pwaStatus.deferredPrompt.prompt();break;case"dismiss":this.setPwaCacheData({showAlert:!1,dismissAlertForever:!0}),this.$emit("change-show-alert",!1);break;case"close":default:this.setPwaCacheData({showAlert:!1}),this.$emit("change-show-alert",!1)}},subscribe:function(){var e=this;navigator.serviceWorker.ready.then((function(t){var n={userVisibleOnly:!0},i=e.pwaSettings.pushKey;i&&(n.applicationServerKey=Object(h.l)(i)),t.pushManager.subscribe(n).then((function(t){e.isPushEnabled=!0,e.updateSubscription(t)})).catch((function(e){"denied"===Notification.permission?console.warn("Permission for Notifications was denied"):console.warn("Unable to subscribe to push.",e)}))}))},unsubscribe:function(){var e=this;navigator.serviceWorker.ready.then((function(t){t.pushManager.getSubscription().then((function(t){e.storage.destroy(e.storageNames.installed),t?t.unsubscribe().then((function(){e.deleteSubscription(t)})).catch((function(e){console.warn("Unsubscription error: ",e)})).finally((function(){e.isPushEnabled=!1})):e.isPushEnabled=!1})).catch((function(e){console.warn("Error thrown while unsubscribing.",e)}))}))},updateSubscription:function(e){var t,n=this,i=e.getKey("p256dh"),s=e.getKey("auth"),a=(PushManager.supportedContentEncodings||["aesgcm"])[0],o={endpoint:e.endpoint,publicKey:i?btoa(String.fromCharCode.apply(null,new Uint8Array(i))):null,authToken:s?btoa(String.fromCharCode.apply(null,new Uint8Array(s))):null,contentEncoding:a,session:null===(t=this.sessionData)||void 0===t?void 0:t._id};this.loading=!0,g.a.post("/push/subscribe",o).finally((function(){n.loading=!1}))},deleteSubscription:function(e){var t,n=this;this.loading=!0;var i={endpoint:e.endpoint||null,session:null===(t=this.sessionData)||void 0===t?void 0:t._id};this.setPwaCacheData({installed:!1,showAlert:!0}),this.$emit("change-show-alert",!0),g.a.post("/push/subscribe/delete",i).finally((function(){n.loading=!1}))},setPwaCacheData:function(e){var t=e.installed,n=e.showAlert,i=e.dismissAlertForever;void 0!==t&&(this.pwaStatus.installed=t,this.storage.set(this.storageNames.installed,t,{expires:1,sameSite:"none",secure:!0}),w.a.$emit("pwa-installed-status",this.pwaStatus.installed)),void 0!==n&&(this.pwaStatus.showAlert=n,this.storage.set(this.storageNames.showBanner,n,{expires:1,sameSite:"none",secure:!0})),void 0!==i&&(this.pwaStatus.dismissAlertForever=i,this.storage.set(this.storageNames.dismissBanner,i,{expires:1,sameSite:"none",secure:!0}))}}},_=Object(p.a)(y,(function(){var e=this,t=e._self._c;return e.isOpen&&e.sessionData&&!e.isIosPlatform?t("transition",["window"!==e.windowMode&&"window-mobile"!==this.windowMode||!0!==e.pwaStatus.showAlert||!1!==e.pwaStatus.dismissAlertForever?"full"===e.windowMode&&!1===e.pwaStatus.installed&&!0===e.pwaStatus.showAlert?t("banner-message",{scopedSlots:e._u([{key:"text",fn:function(){return[t("p",[e._v(e._s(e.$t("pwa.install_message")))])]},proxy:!0},{key:"actions",fn:function(){return[t("a",{staticClass:"cancel",on:{click:function(t){return t.preventDefault(),e.buttonInstallerAction("close")}}},[e._v("\n        "+e._s(e.$t("pwa.deny_button"))+"\n      ")]),e._v(" "),t("a",{staticClass:"submit",on:{click:function(t){return t.preventDefault(),e.buttonInstallerAction("install")}}},[e._v("\n        "+e._s(e.$t("pwa.install_button"))+"\n      ")])]},proxy:!0}],null,!1,1173877997)}):e._e():t("banner-message",{scopedSlots:e._u([{key:"text",fn:function(){return[t("p",[e._v(e._s(e.$t("pwa.install_message")))])]},proxy:!0},{key:"actions",fn:function(){return[!0===e.pwaStatus.installed?t("a",{staticClass:"cancel",on:{click:function(t){return t.preventDefault(),e.buttonInstallerAction("dismiss")}}},[e._v("\n        "+e._s(e.$t("pwa.dismiss_button"))+"\n      ")]):t("a",{staticClass:"cancel",on:{click:function(t){return t.preventDefault(),e.buttonInstallerAction("close")}}},[e._v("\n        "+e._s(e.$t("pwa.deny_button"))+"\n      ")]),e._v(" "),t("a",{staticClass:"submit",attrs:{target:"_parent",href:e.iframeInstallerLink}},[e._v("\n        "+e._s(e.$t("pwa.access_button"))+"\n      ")])]},proxy:!0}],null,!1,727016332)})],1):e._e()}),[],!1,null,null,null).exports;function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C,k,M,x,I=[8,16,17,18,46,37,38,39,40],P=null,$={components:{AppIconInitializer:f,PwaInitializer:_,ModalFinishSession:function(){return Promise.all([n.e(11),n.e(33)]).then(n.bind(null,"mRK9"))},VHeader:function(){return n.e(44).then(n.bind(null,"BBiw"))},VBody:function(){return Promise.all([n.e(6),n.e(19),n.e(16),n.e(22),n.e(32)]).then(n.bind(null,"c6gf"))},ChatButton:function(){return n.e(38).then(n.bind(null,"o8A7"))},UserInput:function(){return n.e(53).then(n.bind(null,"SQBb"))},EmojiPicker:function(){return Promise.all([n.e(5),n.e(42)]).then(n.bind(null,"yeE9"))},IconSend:function(){return n.e(10).then(n.bind(null,"kcej"))},IconClose:function(){return n.e(4).then(n.bind(null,"uu/f"))},IconMinimize:function(){return n.e(30).then(n.bind(null,"Luax"))},IconRefresh:function(){return n.e(49).then(n.bind(null,"9Psv"))},IconFinishSession:function(){return n.e(9).then(n.bind(null,"oFWc"))},IconPhone:function(){return n.e(48).then(n.bind(null,"x+Sg"))},BtnActions:function(){return n.e(36).then(n.bind(null,"Rx/+"))},ChatLoading:function(){return n.e(40).then(n.bind(null,"8EAv"))},Dropzone:function(){return n.e(41).then(n.bind(null,"81xn"))},PreviewFile:function(){return Promise.all([n.e(5),n.e(11),n.e(51)]).then(n.bind(null,"0vUo"))},ErrorMessage:function(){return Promise.all([n.e(5),n.e(43)]).then(n.bind(null,"jifH"))},ContactForm:function(){return Promise.all([n.e(0),n.e(1),n.e(3),n.e(2),n.e(27)]).then(n.bind(null,"WpOP"))},UserForm:function(){return Promise.all([n.e(0),n.e(1),n.e(3),n.e(2),n.e(28)]).then(n.bind(null,"qnRl"))},CallMe:function(){return Promise.all([n.e(0),n.e(1),n.e(3),n.e(2),n.e(31)]).then(n.bind(null,"tJGG"))}},props:{id:{default:"sz4-chat",type:String},btnId:{default:"sz4-btn-chat",type:String},host:{type:String},session:{},clientId:{required:!0},title:{type:String,required:!0},subtitle:{type:String},avatar:{type:String},online:{},theme:{type:Object},buttonOptions:{type:Object},labelOptions:{type:Object},animation:{type:String,validator:function(e){return["slide","fade","scale","scale-rotate"].includes(e)}},browserInfo:{type:String|Object},windowMode:{type:String,validator:function(e){return["window","window-mobile","full"].includes(e)}},showAgentTyping:{type:Boolean,default:!0},playSoundNewMessages:{type:Boolean,default:!0},soundNewMessages:{type:String,default:"assets/sounds/click-sound-effect.mp3"},preview:{type:Boolean,default:!1},previewDev:{type:Boolean,default:!1},showFormWhenOffline:{type:Boolean},userForm:{type:Object},openOnHover:{type:Boolean,default:!1},showResetChat:{type:Boolean,default:!0},showCallMe:{type:Boolean,default:!1},beforeOpen:{type:Function},beforeClose:{type:Function},afterOpen:{type:Function},afterClose:{type:Function},dropzoneOptions:{type:Object},websocket:{},messages:{type:Array},isLoading:{type:Boolean,default:!1},inputMessage:{type:String,default:""},finishMessage:{type:String,default:""},maxChars:{},keepKeyboardOpen:{type:Boolean},inputDisabled:{type:Boolean},pwaConfig:{type:Object}},data:function(){return{isOpen:null,inputScroll:null,showPwaAlert:!1,message:"",messages_:[],isDragOver:!1,isDropzoneOpen:!1,file:null,isRecording:!1,error:!1,agentIsTyping:!1,typingTimeout:null,queueTimeout:null,sound:null,unreadCount:0,isCallMeOpen:!1,queue:[],isMobile:!1,messageCounter:0}},created:(x=c()(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:w.a.$on("chat:open",this.open),w.a.$on("chat:close",this.close),w.a.$on("chat:hide",this.hide),w.a.$on("chat:show-button",this.showButton),w.a.$on("chat:send-message-to-websocket",this.sendMessageToWebSocket),w.a.$on("chat:send-text-message",this.sendTextMessage),w.a.$on("chat:preview-file",this.previewFile),w.a.$on("chat:send-file",this.sendFile),w.a.$on("chat:error",this.showError),w.a.$on("chat:agent-typing",this.showTyping),w.a.$on("chat:menu-click",this.menuClick),w.a.$on("chat:receive-message",this.receiveMessageFromWebSocket),w.a.$on("chat:download-file",this.downloadFile),w.a.$on("chat-flow-changed",this.flowChanged),w.a.$on("chat:set-messages",this.setMessages),w.a.$on("chat:human-start",this.humanStart),w.a.$on("chat:human-finish",this.humanFinish),window.addEventListener("keydown",this.setInputFocus);case 18:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)}),mounted:function(){"full"===this.windowMode?this.isOpen=!0:this.preview&&(this.isOpen=!1),this.messages_=this.messages},beforeDestroy:function(){w.a.$off(["chat:open","chat:close","chat:hide","chat:show-button","chat:send-message-to-websocket","chat:send-text-message","chat:preview-file","chat:send-file","chat:error","chat:agent-typing","chat:menu-click","chat:receive-message","chat:download-file","chat-flow-changed","chat:set-messages","chat:human-start","chat:human-finish"]),window.removeEventListener("keydown",this.setInputFocus)},methods:{getCurrentDate:h.f,humanStart:function(e){},humanFinish:function(e){},changePwaAlertLayout:function(e){this.showPwaAlert=e},downloadFile:function(e,t){g.a.get(e,{responseType:"blob"}).then((function(e){var n=e.data,i=window.URL.createObjectURL(new Blob([n])),s=document.createElement("a");s.href=i,s.setAttribute("download",t),document.body.appendChild(s),s.click(),s.remove()}))},setMessages:function(e){this.messages_=e},flowChanged:function(e){e.forceClean&&(this.messages_=[])},showError:function(e){this.error=e},previewFile:function(e){this.file=e},selectFile:function(){this.$refs.attachment.click()},handleFileUpload:function(e){(e.target.files||e.dataTransfer.files).length||this.showError({message:this.$t("errors.file_not_found")})},dragStart:function(e){this.isDragOver=!0,e.dataTransfer&&(e.dataTransfer.dropEffect="copy")},dragLeave:function(e){this.isDropzoneOpen&&(this.isDragOver=!1)},showTyping:function(e,t){var n=this;if(this.showAgentTyping){var i=160*(("text"==e.type?e.message:"").length||1);return i=(i=Math.floor(Math.random()*i)+.5*i)<1e3?1e3:i>2300?2300:i,this.agentIsTyping=!0,console.log(i),this.typingTimeout&&clearTimeout(this.typingTimeout),new Promise((function(t,s){n.typingTimeout=setTimeout((function(){n.typingTimeout=null,n.incrementUnreadCount(),n.agentIsTyping=!1,n.messages_.push(e),t()}),i)}))}return this.messages_.push(e),!0},sendAudio:function(e){var t=this,n={event:"message",origin:"channel",type:"sounds",filename:"audio",file:"",message:"",legend:"",duration:e.duration||"",name:this.session.name||"",channel_id:this.session.channel_id,client_id:this.clientId,web_id:this.session.platform_id,email:this.session.email||"",created_at:this.getCurrentDate(),user:{name:this.session.name,email:this.session.email}},i=new FileReader;i.readAsDataURL(e.blob),i.onload=function(e){n.file=e.target.result,n.state="loading",t.sendMessageToWebSocket(n),setTimeout((function(){n.state="sent",t.$nextTick().then((function(){t.$forceUpdate()}))}),500)}},sendFile:function(e){var t=this,n=e.file,i={event:"shared",origin:"channel",type:e.type||"",legend:e.legend||"",filename:e.file.name,message:"",file:"",name:this.session.name||"",channel_id:this.session.channel_id||"",client_id:this.clientId||"",web_id:this.session.platform_id||"",email:this.session.email||"",created_at:this.getCurrentDate(),user:{name:this.session.name,email:this.session.email}};switch(e.type){case"images":case"videos":case"sounds":case"files":var s=new FileReader;s.readAsDataURL(n),s.onload=function(e){i.file=e.target.result,i.state="loading",t.sendMessageToWebSocket(i),setTimeout((function(){i.state="sent",t.$nextTick().then((function(){t.$forceUpdate()}))}),500)};break;default:return void this.showError({message:this.$t("errors.file_not_allowed")})}},sendTextMessage:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&e.trim()){var n={event:"message",origin:"channel",type:"text",message:this.HtmlEncode(e.trim()),name:this.session.name,channel_id:this.session.channel_id,client_id:this.clientId,web_id:this.session.platform_id,email:this.session.email,created_at:this.getCurrentDate()};this.sendMessageToWebSocket(n),t&&this.clearUserInput()}else t&&this.clearUserInput()},sendMessageToWebSocket:function(e){if(this.preview)return!1;this.messages_.push(e);var t={state:void 0};this.websocket&&this.websocket.emit(JSON.stringify(S(S({},e),t)))},generateQueueId:function(e){return this.messageCounter++},receiveMessageFromWebSocket:function(e){this.queue.push(S(S({},e),{},{id:Date.now()+Math.random()+""})),this.$forceUpdate()},removeMessageQueue:function(e){var t=this.queue.findIndex((function(t){return t.id===e}));t>-1&&this.queue.splice(t,1)},proccessQueue:function(){var e=this,t=[];this.forEachAsync(this.queue,function(){var n=c()(u.a.mark((function n(i,s){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.push(i.id),n.next=3,e.showTyping(i,s);case 3:e.removeMessageQueue(i.id);case 4:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())},clearUserInput:function(){w.a.$emit("user-input:clear"),w.a.$emit("emoji-picker:close"),this.message="",Object(h.c)()&&!this.keepKeyboardOpen||w.a.$emit("user-input:focus")},transitionBeforeEnter:function(e){e.id==this.id&&!0===this.isOpen&&w.a.$emit("chat-opening"),e.id==this.btnId&&!1===this.isOpen&&w.a.$emit("chat-button-opening")},transitionAfterEnter:(M=c()(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.id==this.id&&1==this.isOpen&&w.a.$emit("chat-opened"),t.id==this.btnId&&!1===this.isOpen&&(w.a.$emit("chat-button-opened"),this.labelOptions.enabled&&this.labelOptions.delay>0?setTimeout((function(){w.a.$emit("chat:show-button-label")}),1e3*this.labelOptions.delay):this.labelOptions.enabled&&w.a.$emit("chat:show-button-label"));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)}),transitionBeforeLeave:function(e){e.id==this.id&&!1===this.isOpen&&w.a.$emit("chat-closing"),e.id==this.btnId&&!0===this.isOpen&&w.a.$emit("chat-button-closing")},transitionAfterLeave:function(e){e.id==this.id&&!1===this.isOpen&&w.a.$emit("chat-closed"),e.id==this.btnId&&!0===this.isOpen&&w.a.$emit("chat-button-closed")},btnSendClick:function(e){this.sendTextMessage(this.message)},setInputFocus:function(e){if(e){if(-1!==I.indexOf(e.keyCode))return!1;if("c"==e.keyCode&&e.ctrlKey)return!1;if((e.ctrlKey||e.shiftKey)&&"v"!=e.keyCode)return!1}if(this.preview)return!1;!this.isOpen||this.isDragOver||this.file||this.isCallMeOpen||(e&&e.target&&"user-input"!==e.target.id||0==!e)&&w.a.$emit("user-input:focus",e)},open:(k=c()(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof this.beforeOpen){e.next=3;break}return e.next=3,this.beforeOpen();case 3:this.isOpen=!0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)}),close:(C=c()(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof this.beforeClose){e.next=3;break}return e.next=3,this.beforeClose();case 3:if("full"!==this.windowMode){e.next=5;break}return e.abrupt("return");case 5:if("object"!==s()(t)||1!=t.force){e.next=10;break}return this.isOpen=!1,w.a.$emit("chat-closing",{force:!0}),w.a.$emit("chat-closed",{force:!0}),e.abrupt("return");case 10:!0===this.isOpen&&(this.isOpen=!1);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)}),resetFlow:function(){w.a.$emit("chat:flow-restart",{forceClean:!0})},finishSession:function(){w.a.$emit("modalfinish:open")},showButton:function(){"full"!==this.windowMode&&(this.isOpen=!1,w.a.$emit("chat-closing"),w.a.$emit("chat-closed"))},hide:function(){null!==this.isOpen&&(this.isOpen=null)},toogleCallMe:function(){this.showCallMe&&(this.isCallMeOpen=!this.isCallMeOpen)},HtmlEncode:h.a,forEachAsync:h.d,closeError:function(){this.error=null,P&&clearTimeout(P)},incrementUnreadCount:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=this.unreadCount+t;this.unreadCount=0,!1===this.isOpen&&setTimeout((function(){e.unreadCount=n>99?"99+":n}),500)},playSound:function(){if(this.playSoundNewMessages&&!this.isOpen){var e=new Audio(this.soundNewMessages);e.volume=.5;try{e.play()}catch(e){console.error(e)}}},menuClick:function(e){var t=this.messages_.findIndex((function(t){return t.id==e.id}));this.messages_.splice(t,1),this.sendTextMessage(e.option.text,!1)}},computed:{getWindowMonde:function(){return this.pwaConfig.enabled&&this.showPwaAlert?"".concat(this.windowMode," padding-pwa-content"):this.windowMode},getMessages:function(){return this.messages_}},watch:{isOpen:function(e,t,n){!0===e&&"function"==typeof this.afterOpen&&this.afterOpen(),!1===e&&"function"==typeof this.afterClose&&this.afterClose(),null===e&&w.a.$emit("chat-hidden"),!0===e&&(this.unreadCount=0)},error:function(){var e=this;this.error&&(P=setTimeout((function(){e.error&&(e.error=null)}),1e4))},messages:{deep:!0,handler:function(e,t){this.messages_=e}},unreadCount:function(e,t){var n=this;e&&e>t&&setTimeout((function(){return n.playSound()}),300)},queue:function(e,t){var n=this;this.queueTimeout&&clearTimeout(this.queueTimeout),e.length&&(this.queueTimeout=setTimeout(c()(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.proccessQueue();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),500))}}},A=(n("+SXb"),Object(p.a)($,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"sz4-chat",class:[e.preview?"preview-mode":""]},[t("transition",{attrs:{name:"full"!==e.windowMode?e.animation:"fade",mode:"out-in"},on:{"after-enter":e.transitionAfterEnter,"after-leave":e.transitionAfterLeave,"before-enter":e.transitionBeforeEnter,"before-leave":e.transitionBeforeLeave}},[e.pwaConfig.enabled?t("pwa-initializer",{attrs:{"pwa-settings":e.pwaConfig,"session-data":e.session,"is-open":e.isOpen,"window-mode":e.windowMode},on:{"change-show-alert":e.changePwaAlertLayout}}):e._e()],1),e._v(" "),"full"===e.windowMode?t("app-icon-initializer",{attrs:{"pwa-settings":e.pwaConfig}}):e._e(),e._v(" "),t("transition",{attrs:{name:"full"!==e.windowMode?e.animation:"fade",mode:"out-in"},on:{"after-enter":e.transitionAfterEnter,"after-leave":e.transitionAfterLeave,"before-enter":e.transitionBeforeEnter,"before-leave":e.transitionBeforeLeave}},[!0===e.isOpen?t("div",{staticClass:"chat",class:e.getWindowMonde,attrs:{id:e.id},on:{dragover:function(t){return t.preventDefault(),e.dragStart.apply(null,arguments)},dragleave:e.dragLeave}},[e.userForm.enabled&&(!e.session||e.session.hasOwnProperty("form_filled")&&!e.session.form_filled)?[t("keep-alive",[t("user-form",{attrs:{fields:e.userForm.fields,title:e.userForm.title,subtitle:e.avatar,avatar:e.avatar,preview:e.preview}},[t("template",{slot:"actions"},["full"!==e.windowMode?t("icon-close",{staticClass:"close",nativeOn:{click:function(t){return e.close()}}}):e._e()],1)],2)],1)]:!1===e.online&&e.showFormWhenOffline?[t("contact-form",[t("template",{slot:"actions"},["full"!==e.windowMode?t("icon-close",{staticClass:"close",nativeOn:{click:function(t){return e.close()}}}):e._e()],1)],2)]:[t("transition",[t("modal-finish-session",{attrs:{"finish-message":e.finishMessage||e.$t("chat_finish_session")}})],1),e._v(" "),t("keep-alive",[t("v-header",{attrs:{title:e.title,subtitle:e.subtitle,avatar:e.avatar,online:e.online,theme:e.theme,host:e.host}},[t("div",{staticClass:"actions",attrs:{slot:"actions"},slot:"actions"},["full"!==e.windowMode?t("icon-minimize",{nativeOn:{click:function(t){return e.close()}}}):e._e(),e._v(" "),e.session&&"auto"===e.session.phase&&!e.session.isAttendance?t("icon-refresh",{nativeOn:{click:function(t){return e.resetFlow()}}}):e._e(),e._v(" "),!0===e.online&&e.showCallMe?t("icon-phone",{nativeOn:{click:function(t){return e.toogleCallMe()}}}):e._e(),e._v(" "),e.session?t("icon-close",{nativeOn:{click:function(t){return e.finishSession()}}}):e._e()],1)])],1),e._v(" "),t("transition",[e.error?t("error-message",{nativeOn:{click:function(t){return e.closeError.apply(null,arguments)}}},[e._v(e._s(e.error.message)+"\n          ")]):e._e()],1),e._v(" "),t("keep-alive",[t("v-body",{attrs:{messages:e.getMessages,"agent-typing":e.agentIsTyping,theme:e.theme}})],1),e._v(" "),t("div",{attrs:{id:"chat-body-fallback"}}),e._v(" "),t("keep-alive",[t("footer",[e.isRecording?e._e():t("emoji-picker",{staticClass:"btn-icon size-3x"}),e._v(" "),e.isRecording?e._e():t("div",{staticClass:"user-input-container"},[t("user-input",{attrs:{disabled:e.inputDisabled,readonly:e.preview,"max-chars":e.maxChars,"input-message":e.inputMessage||e.$t("user_input_placeholder"),"keep-keyboard-open":e.keepKeyboardOpen},on:{send:function(t){return e.sendTextMessage(e.message)}},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1),e._v(" "),t("transition",{attrs:{mode:"out-in",name:"fade",duration:100}},[e.message?t("icon-send",{staticClass:"btn-icon size-3x",nativeOn:{click:function(t){return e.btnSendClick.apply(null,arguments)}}}):t("btn-actions",{on:{"click-attachment":function(t){return e.selectFile()},"audio-recorded":e.sendAudio,"audio-stop":function(t){e.isRecording=!1},"audio-start":function(t){e.isRecording=!0}}})],1)],1)]),e._v(" "),t("transition",{attrs:{duration:100}},[e.isDragOver?t("dropzone",{on:{open:function(t){e.isDropzoneOpen=!0},close:function(t){e.isDragOver=!1,e.isDropzoneOpen=!1}}}):e._e()],1),e._v(" "),t("transition",[e.isLoading?t("chat-loading"):e._e()],1),e._v(" "),e.file?t("preview-file",{attrs:{file:e.file},on:{close:function(t){e.file=null}}}):e._e(),e._v(" "),t("transition",[e.isCallMeOpen?t("call-me",{attrs:{title:e.title,subtitle:e.subtitle,avatar:e.avatar,online:e.online},on:{close:e.toogleCallMe}},[t("template",{slot:"actions"},["full"!==e.windowMode?t("icon-close",{staticClass:"close",nativeOn:{click:function(t){return e.close()}}}):e._e()],1)],2):e._e()],1),e._v(" "),t("form",{staticClass:"form-hidden",attrs:{enctype:"multipart/form-data",id:"form-attachment"}},[t("input",{ref:"attachment",attrs:{type:"file",id:"attachment"},on:{change:function(t){return e.previewFile(t.target.files[0]||t.dataTransfer.files[0])}}})])]],2):!1===e.isOpen?t("chat-button",{attrs:{id:e.btnId,"label-options":e.labelOptions,type:e.buttonOptions.type,icon:e.buttonOptions.icon,src:e.buttonOptions.src,color:e.buttonOptions.color,"unread-count":e.unreadCount,online:e.online},nativeOn:{click:function(t){e.preview||e.open()},mouseenter:function(t){e.openOnHover&&!e.preview&&e.open()}}}):e._e()],1)],1)}),[],!1,null,"7267a046",null));t.default=A.exports}}]);